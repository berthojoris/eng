#!/usr/bin/env node

"use strict";
var color = require('colors');
var util = require('util');
var fs = require('fs-extra');
var sys = require('sys')
var exec = require('child_process').exec;
var colors = require('colors');
var argv = require('optimist').argv;
console.log("..................... "+ "Eng Develovment".green +" ...........................");
console.log("........................... "+ "By".green +" ..................................");
console.log("........................"+ "ukungzulfah".green +"..............................");
console.log(".................................................................");


if( argv._.length ){
	
	switch(argv._[0]){
		
		case 'uninstall':
			var appName = argv._[1];
			var dir = process.cwd();
			process.stdin.resume();
			console.log( 'Are you sure uninstall '+ appName.red +' [y/n]' );
			process.stdin.on('data', function (text) {
				var cek = text.toString().replace('\r\n', '');
				if(cek === 'y'){
					fs.remove( dir + '/' +appName, function(err){
						if (err) return console.error(err);
						console.log( 'App Uninstall' );
						process.exit();
					});
				}else{
					console.log( cek );
					console.log( 'Cancel Uninstall' );
					process.exit();
				}
			});
			break
		
		case 'install':
			var dir = process.cwd();
			process.stdin.resume();
			console.log("Create new Project, insert project name: ");
			process.stdin.on('data', function (text) {
				var dirName = text.toString().replace('\r\n', '');
				
				console.log("create project name");
				createDir(dirName, function(){
					console.log("install application");
					fs.copy( __dirname +'/../lib', dir +'/'+ dirName,  function(){
						console.log(".................................................................".green);
						console.log(".................................................................".green);
						console.log(".................................................................".green);
						console.log(".........".green+ "Congratulation, Application success installing".blue +"..........".green);
						console.log(".................................................................".green);
						console.log(".................................................................".green);
						console.log(".................................................................".green);
						console.log("..................... ".green+ "Eng Develovment".white +" ...........................".green);
						console.log("........................... ".green+ "By".white +" ..................................".green);
						console.log("........................".green+ "ukungzulfah".white +"..............................".green);
						console.log(".................................................................".green);
						console.log(".................................................................".green);
						console.log(".................................................................".green);
						console.log('');
						console.log("Enter ".white +"cd ".yellow + dirName.yellow);
						console.log("Enter ".white +"node server.js".yellow);
						process.exit();
					});
					
				});
				
			});
			
			///end
			break;
	}
	
}


function createDir(path, callback){
	fs.mkdir(path,function(e){
		if(!e || (e && e.code === 'EEXIST')){
			console.log("folder exists");
		} else {
			//debug
			console.log(e);
		}
		callback();
	});
}


